<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- ----------------------------------------------- -->
    <!--  Part below should be pasted in webflow element -->
    <!-- ----------------------------------------------- -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <div id="transcriptions_text" style="display: none">
      <h5 id="file_name"></h5>
      <p id="transcription_text"></p>
    </div>

    <script>
      const API_URL = "https://api.platic.io";
      const GET_TRANSCRIPTION_URL = API_URL + "/get-transcription";

      // * Get users id from firebase *

      // Initialize Firebase
      if (typeof app === "undefined") {
        const firebase_config = {
          apiKey: "AIzaSyAgpnAKfoscIFAYhutFnh_B5YnQtplupP4",
          authDomain: "platic-firebase.firebaseapp.com",
          projectId: "platic-firebase",
          storageBucket: "platic-firebase.appspot.com",
          messagingSenderId: "19750389430",
          appId: "1:19750389430:web:3730f997af20458939c817",
        };
        const app = firebase.initializeApp(firebase_config);
      }

      // Get file id from the url file_id parameter and file name
      const urlParams = new URLSearchParams(window.location.search);
      const file_id = urlParams.get("file_id");
      const file_name = urlParams.get("file_name");

      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          // Get transcription from file_id
          get_transcription(file_id).then((transcription) => {
            // If there is a transcription, show the text
            if (transcription) {
              document.getElementById("transcriptions_text").style.display =
                "block";
              document.getElementById("file_name").innerHTML = file_name;
              document.getElementById("transcription_text").innerHTML =
                transcription["transcription"];
            }
          });
        }
      });

      // Get transcription GET function
      async function get_transcription(file_id) {
        const response = await fetch(
          GET_TRANSCRIPTION_URL + "?file_name_stored=" + file_id
        );
        const data = await response.json();
        return data;
      }
    </script>
    <!-- ----------------------------------------------- -->
    <!-- --------------STOP PASTING HERE---------------- -->
    <!-- ----------------------------------------------- -->
  </body>
</html>
